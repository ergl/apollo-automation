{run_template, "run.config.template"}.
{cluster_template, "cluster.config.template"}.

{load_configuration, #{
    key_limit => 1000000,
    %% size of value in bytes
    val_size => 256
}}.

%% Syntax for each experiment:
#{
    %% Number of threads per client machine.
    %% Allowed values are numbers (like `1`, `20`, etc), list of numbers,
    %% or a MFA ({M, F, A}) that in the end produces a generator of numbers
    %% For example, the line below produces the list [0, 50, 100]
    %% NOTE: The minimum number of workers is 1. All values less than 1 will be set to 1.
    clients => {lists, seq, [0, 100, 50]},

    %% The folder name under $HOME/results where all results for this test will go
    results_folder => "test_name",

    %% A map of template subsitutions.
    %% Check run.config.template for available values.
    %% In essence, anything present below will be changed in the corresponding
    %% run.config file supplied to the benchmark.
    %% Any key will be overriden, but the minimum amount of keys to be present
    %% is shown below.
    run_with => #{
        operations => [read],
        readonly_ops => 1,
        retry_aborts => false,
        %% Valid values: uniform, pareto. Uniform is default if omitted
        key_distribution => uniform
    },

    %% A map of config template subsitutions.
    %% Check cluster.config.template for available values.
    %% For the `clusters` key, you can either input a list of replica names,
    %% or a raw map like we used in old cluster.config files
    %%
    %% For the `leaders` key, you can put either a map from partition number
    %% to replica name, or a single replica name, in which case it will
    %% be used as the replica for every partition. If the `leaders` key is
    %% omitted, then a replica will be used at random.
    run_on => #{
        ext_tag => "release-X.Y.Z",
        clusters => [virginia],
        partitions => 1,
        %% This can be a number, or the `auto` atom, in which case it will
        %% allocate client machines automatically uniformly across all partitions,
        %% using all the available machines.
        per_partition => 4
    }
}.

{experiments,
    [
        %% Experiment with less client machines, but more connections
        #{
            results_folder => "uniform_200k_runner_modify_connection_12",
            clients => [0, 50, 100, 200, 300, 600, 1200, 1600, 2000, 2400, 2800, 4000],
            run_on => #{
                ext_tag => "release-0.1.15",
                leaders => virginia,
                clusters => [virginia],
                partitions => 1,
                per_partition => 2
            },
            run_with => #{
                conn_pool_size => 12,
                duration => 5,
                report_interval => 5,
                key_range => 200000,
                operations => [read_random_pool],
                readonly_ops => 1,
                retry_aborts => false,
                key_distribution => uniform
            }
        },
        #{
            results_folder => "uniform_200k_runner_modify_connection_12",
            clients => [0, 50, 100, 200, 300, 600, 1200, 1600, 2000, 2400, 2800, 4000],
            run_on => #{
                ext_tag => "release-0.1.15",
                leaders => virginia,
                clusters => [virginia],
                partitions => 2,
                per_partition => 2
            },
            run_with => #{
                conn_pool_size => 12,
                duration => 5,
                report_interval => 5,
                key_range => 200000,
                operations => [read_random_pool],
                readonly_ops => 1,
                retry_aborts => false,
                key_distribution => uniform
            }
        },
        #{
            results_folder => "uniform_200k_runner_modify_connection_12",
            clients => [0, 50, 100, 200, 300, 600, 1200, 1600, 2000, 2400, 2800, 4000],
            run_on => #{
                ext_tag => "release-0.1.15",
                leaders => virginia,
                clusters => [virginia],
                partitions => 4,
                per_partition => 2
            },
            run_with => #{
                conn_pool_size => 12,
                duration => 5,
                report_interval => 5,
                key_range => 200000,
                operations => [read_random_pool],
                readonly_ops => 1,
                retry_aborts => false,
                key_distribution => uniform
            }
        },
        % Now with 24 connection
        #{
            results_folder => "uniform_200k_runner_modify_connection_24",
            clients => [0, 50, 100, 200, 300, 600, 1200, 1600, 2000, 2400, 2800, 4000],
            run_on => #{
                ext_tag => "release-0.1.15",
                leaders => virginia,
                clusters => [virginia],
                partitions => 1,
                per_partition => 2
            },
            run_with => #{
                conn_pool_size => 24,
                duration => 5,
                report_interval => 5,
                key_range => 200000,
                operations => [read_random_pool],
                readonly_ops => 1,
                retry_aborts => false,
                key_distribution => uniform
            }
        },
        #{
            results_folder => "uniform_200k_runner_modify_connection_24",
            clients => [0, 50, 100, 200, 300, 600, 1200, 1600, 2000, 2400, 2800, 4000],
            run_on => #{
                ext_tag => "release-0.1.15",
                leaders => virginia,
                clusters => [virginia],
                partitions => 2,
                per_partition => 2
            },
            run_with => #{
                conn_pool_size => 24,
                duration => 5,
                report_interval => 5,
                key_range => 200000,
                operations => [read_random_pool],
                readonly_ops => 1,
                retry_aborts => false,
                key_distribution => uniform
            }
        },
        #{
            results_folder => "uniform_200k_runner_modify_connection_24",
            clients => [0, 50, 100, 200, 300, 600, 1200, 1600, 2000, 2400, 2800, 4000],
            run_on => #{
                ext_tag => "release-0.1.15",
                leaders => virginia,
                clusters => [virginia],
                partitions => 4,
                per_partition => 2
            },
            run_with => #{
                conn_pool_size => 24,
                duration => 5,
                report_interval => 5,
                key_range => 200000,
                operations => [read_random_pool],
                readonly_ops => 1,
                retry_aborts => false,
                key_distribution => uniform
            }
        }
    ]
}.
